<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">

    <modelVersion>4.0.0</modelVersion>

    <parent>
        <groupId>it.unibz.inf.ontop</groupId>
        <artifactId>ontop-protege</artifactId>
        <version>5.0.1-SNAPSHOT</version>
    </parent>

    <artifactId>ontop-protege-plugin</artifactId>
    <description>Ontop OBDA plugin for protégé</description>
    <url>http://ontop.inf.unibz.it/</url>

    <organization>
        <name>KRDB Research Centre for Knowledge and Data, Free University of Bozen-Bolzano</name>
        <url>http://www.inf.unibz.it/krdb/</url>
    </organization>

    <properties>
        <guava.version>18.0</guava.version> <!-- Protégé version -->
        <owlapi.version>4.5.20</owlapi.version> <!-- Protégé version -->
        <h2.version>2.1.214</h2.version> <!-- testing -->
        <symbolic.name>it.unibz.inf.ontop.protege</symbolic.name>
        <finalName>${symbolic.name}-${project.version}</finalName>
        <filter.main.resources>true</filter.main.resources>
        <skipTests>true</skipTests>
        <bundle.protege.phase>package</bundle.protege.phase>
    </properties>

    <dependencies>
        
        <dependency>
            <groupId>${project.groupId}</groupId>
            <artifactId>ontop-protege-dependencies</artifactId>
            <classifier>shaded</classifier>
            <version>${project.version}</version>
        </dependency>

        <!-- owlapi used in Protege -->
        <dependency>
            <groupId>net.sourceforge.owlapi</groupId>
            <artifactId>owlapi-osgidistribution</artifactId>
            <version>${owlapi.version}</version>
            <scope>provided</scope>
        </dependency>

        <dependency>
            <groupId>org.osgi</groupId>
            <artifactId>org.osgi.core</artifactId>
            <version>6.0.0</version>
        </dependency>
        
        <!-- dependencies available from Protege: begin -->
        <dependency>
            <groupId>org.slf4j</groupId>
            <artifactId>slf4j-api</artifactId>
            <scope>provided</scope>
        </dependency>
        <dependency>
            <groupId>ch.qos.logback</groupId>
            <artifactId>logback-classic</artifactId>
            <scope>provided</scope>
        </dependency>
        <dependency>
            <groupId>ch.qos.logback</groupId>
            <artifactId>logback-core</artifactId>
            <scope>provided</scope>
        </dependency>
        <!-- dependencies available from Protege: end -->

        <dependency>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
            <scope>test</scope>
        </dependency>

        <dependency>
            <groupId>xerces</groupId>
            <artifactId>xercesImpl</artifactId>
        </dependency>
        <dependency>
            <groupId>xml-apis</groupId>
            <artifactId>xml-apis</artifactId>
        </dependency>
        <dependency>
            <groupId>org.apache.thrift</groupId>
            <artifactId>libthrift</artifactId>
        </dependency>

        <!-- Protege and OWLAPI bundle dependencies -->
        <dependency>
            <groupId>edu.stanford.protege</groupId>
            <artifactId>protege-editor-core</artifactId>
            <scope>provided</scope>
            <exclusions>
                <exclusion>
                    <artifactId>semargl-rdfa</artifactId>
                    <groupId>org.semarglproject</groupId>
                </exclusion>
            </exclusions>
        </dependency>
        <dependency>
            <groupId>edu.stanford.protege</groupId>
            <artifactId>protege-editor-owl</artifactId>
            <scope>provided</scope>
        </dependency>

        <!-- transitive dependencies -->
        <dependency>
            <groupId>org.abego.treelayout</groupId>
            <artifactId>org.abego.treelayout.core</artifactId>
        </dependency>
        <dependency>
            <groupId>org.glassfish</groupId>
            <artifactId>javax.json</artifactId>
        </dependency>
        <dependency>
            <groupId>com.ibm.icu</groupId>
            <artifactId>icu4j</artifactId>
        </dependency>
        
        <dependency>
            <groupId>com.google.guava</groupId>
            <artifactId>failureaccess</artifactId>
        </dependency>
        
        <!-- testing -->
        <dependency>
            <groupId>com.h2database</groupId>
            <artifactId>h2</artifactId>
            <version>${h2.version}</version>
            <scope>test</scope>
        </dependency>
    </dependencies>

    <build>
        <plugins>
            <plugin>
                <groupId>org.apache.felix</groupId>
                <artifactId>maven-bundle-plugin</artifactId>
                <version>${maven-bundle-plugin.version}</version>
                <extensions>true</extensions>
                <executions>
                    <execution>
                        <id>attach-protege-bundle</id>
                        <phase>${bundle.protege.phase}</phase>
                        <goals>
                            <goal>bundle</goal>
                        </goals>
                        <configuration>
                            <classifier>bundle</classifier>
                            <!-- The following is the set of instructions of how pack the bundle and how to create the
                                 MANIFEST.MF for the bundle. The configuration does 3 things.

                                 1. It makes sure that the "tight" dependencies are not packed as jars, but as .class files
                                    (inline). It makes sure that all the runtime dependencies are packed as jars.

                                 2. It makes sure all the protege plugin resources are packed (plugin.xml, tabs*.xml, etc).

                                 3. It makes sure the META-INF/MANIFEST.MF for OSGi bundles is created with the correct imports,
                                    exports and classpath.
                            -->

                            <instructions>
                                <finalName>${finalName}</finalName>
                                <Bundle-RequiredExecutionEnvironment>JavaSE-11</Bundle-RequiredExecutionEnvironment>
                                <!-- This makes sure any dependency in the obdalib <dependency> dependencies are packed
                                     as .classes (uncompressed, no jars) and the rest is packed as .jars -->
                                <Embed-Dependency>
                                    *;groupId=it.unibz.inf.ontop.*;inline=true,
                                    *;groupId=it.unibz.inf.ontop.protege.*;inline=true,
                                    *;groupId=!it.unibz.inf.ontop;scope=compile|runtime
                                </Embed-Dependency>

                                <!-- necessary for protege plugins -->
                                <Bundle-Category>protege</Bundle-Category>

                                <Bundle-ContactAddress>gh.xiao@gmail.com</Bundle-ContactAddress>
                                <Bundle-DocURL>${project.url}</Bundle-DocURL>
                                <Bundle-Name>Ontop OBDA Protégé plugin</Bundle-Name>
                                <Bundle-Description>${project.description}</Bundle-Description>
                                <Bundle-Vendor>${project.organization.name}</Bundle-Vendor>
                                <Implementation-Version>${project.version}</Implementation-Version>
                                <Update-Url>https://github.com/ontop/ontop/raw/master/ontop-protege/update.properties</Update-Url>

                                <Export-Package>
                                    <!-- No need to export any package -->
                                </Export-Package>

                                <Import-Package>
                                	!javax.servlet.*,
                                    javax.*,
                                    com.google.common.*;version="[18.0,19)",
                                    org.osgi.framework;version="[1.8,2)",
                                    org.slf4j.*;version="[1.7,2)",
                                    org.protege.editor.*;version="[5.5,6)",
                                    !org.semanticweb.owlapi.model.axiomproviders,
                                    org.semanticweb.owlapi.*;version="[4.5,5)",
                                    uk.ac.manchester.cs.owl.owlapi.*;version="[4.5,5)"
                                </Import-Package>

                                <!-- The name of the plugin for OSGi dependencies. It has to be singleton
                                     or protege wont load it -->
                                <Bundle-SymbolicName>${symbolic.name};singleton:=true</Bundle-SymbolicName>

                                <Bundle-Activator>org.protege.osgi.jdbc.JdbcBundleActivator</Bundle-Activator>
                            </instructions>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
        </plugins>
        <resources>
            <resource>
                <directory>src/main/resources</directory>
                <filtering>true</filtering>
            </resource>
        </resources>
    </build>

</project>
